<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>13F Fund Holdings Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.8.0/Recharts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9fafb;
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

```
<script type="text/babel">
    const { useState, useEffect } = React;
    const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, LineChart, Line, ComposedChart, Area, AreaChart } = Recharts;

    // Lucide icons as SVG components
    const Download = () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7,10 12,15 17,10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
    );

    const TrendingUp = () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <polyline points="22,7 13.5,15.5 8.5,10.5 2,17"></polyline>
            <polyline points="16,7 22,7 22,13"></polyline>
        </svg>
    );

    const TrendingDown = () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <polyline points="22,17 13.5,8.5 8.5,13.5 2,7"></polyline>
            <polyline points="16,17 22,17 22,11"></polyline>
        </svg>
    );

    const Building2 = () => (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"></path>
            <path d="M6 12H4a2 2 0 0 0-2 2v8h4"></path>
            <path d="M18 9h2a2 2 0 0 1 2 2v11h-4"></path>
            <path d="M10 6h4"></path>
            <path d="M10 10h4"></path>
            <path d="M10 14h4"></path>
            <path d="M10 18h4"></path>
        </svg>
    );

    const DollarSign = () => (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <line x1="12" y1="1" x2="12" y2="23"></line>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </svg>
    );

    const Users = () => (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
    );

    const Activity = () => (
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"></polyline>
        </svg>
    );

    const BarChart3 = () => (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <path d="M3 3v18h18"></path>
            <path d="M18 17V9"></path>
            <path d="M13 17V5"></path>
            <path d="M8 17v-3"></path>
        </svg>
    );

    const FundHoldingsAnalyzer = () => {
        const [loading, setLoading] = useState(false);
        const [commonStocks, setCommonStocks] = useState([]);
        const [changeAnalysis, setChangeAnalysis] = useState([]);
        const [selectedView, setSelectedView] = useState('frequency');
        const [fundData, setFundData] = useState([]);
        const [selectedStock, setSelectedStock] = useState(null);
        const [technicalData, setTechnicalData] = useState({});
        const [showTechnicals, setShowTechnicals] = useState(false);

        // Mock data representing top 30 AUM funds and their 13F holdings
        const mockFundData = [
            {
                fund: "Berkshire Hathaway",
                aum: 659000000000,
                holdings: [
                    { symbol: "AAPL", name: "Apple Inc", shares: 915560000, value: 174500000000, changePercent: 2.5 },
                    { symbol: "GOOGL", name: "Alphabet Inc", shares: 43593006, value: 6200000000, changePercent: -1.2 },
                    { symbol: "BAC", name: "Bank of America", shares: 1010000000, value: 35000000000, changePercent: 3.8 },
                    { symbol: "KO", name: "Coca-Cola", shares: 400000000, value: 25000000000, changePercent: 1.1 },
                    { symbol: "CVX", name: "Chevron", shares: 159178117, value: 24000000000, changePercent: -0.8 }
                ]
            },
            {
                fund: "Vanguard Group",
                aum: 8100000000000,
                holdings: [
                    { symbol: "AAPL", name: "Apple Inc", shares: 1300000000, value: 248000000000, changePercent: 2.5 },
                    { symbol: "MSFT", name: "Microsoft", shares: 830000000, value: 310000000000, changePercent: 1.8 },
                    { symbol: "GOOGL", name: "Alphabet Inc", shares: 180000000, value: 25600000000, changePercent: -1.2 },
                    { symbol: "AMZN", name: "Amazon", shares: 290000000, value: 44000000000, changePercent: 4.2 },
                    { symbol: "TSLA", name: "Tesla", shares: 85000000, value: 22000000000, changePercent: -3.1 }
                ]
            },
            {
                fund: "BlackRock",
                aum: 10000000000000,
                holdings: [
                    { symbol: "AAPL", name: "Apple Inc", shares: 1050000000, value: 200500000000, changePercent: 2.5 },
                    { symbol: "MSFT", name: "Microsoft", shares: 720000000, value: 269000000000, changePercent: 1.8 },
                    { symbol: "NVDA", name: "NVIDIA", shares: 310000000, value: 138000000000, changePercent: 8.7 },
                    { symbol: "GOOGL", name: "Alphabet Inc", shares: 150000000, value: 21300000000, changePercent: -1.2 },
                    { symbol: "AMZN", name: "Amazon", shares: 280000000, value: 42500000000, changePercent: 4.2 }
                ]
            },
            {
                fund: "State Street",
                aum: 4200000000000,
                holdings: [
                    { symbol: "AAPL", name: "Apple Inc", shares: 620000000, value: 118400000000, changePercent: 2.5 },
                    { symbol: "MSFT", name: "Microsoft", shares: 450000000, value: 168000000000, changePercent: 1.8 },
                    { symbol: "NVDA", name: "NVIDIA", shares: 180000000, value: 80000000000, changePercent: 8.7 },
                    { symbol: "GOOGL", name: "Alphabet Inc", shares: 95000000, value: 13500000000, changePercent: -1.2 },
                    { symbol: "JPM", name: "JPMorgan Chase", shares: 85000000, value: 15000000000, changePercent: 2.8 }
                ]
            },
            {
                fund: "Fidelity",
                aum: 4900000000000,
                holdings: [
                    { symbol: "AAPL", name: "Apple Inc", shares: 580000000, value: 110800000000, changePercent: 2.5 },
                    { symbol: "MSFT", name: "Microsoft", shares: 420000000, value: 157000000000, changePercent: 1.8 },
                    { symbol: "AMZN", name: "Amazon", shares: 310000000, value: 47000000000, changePercent: 4.2 },
                    { symbol: "NVDA", name: "NVIDIA", shares: 160000000, value: 71200000000, changePercent: 8.7 },
                    { symbol: "TSLA", name: "Tesla", shares: 95000000, value: 24700000000, changePercent: -3.1 }
                ]
            },
            {
                fund: "T. Rowe Price",
                aum: 1600000000000,
                holdings: [
                    { symbol: "MSFT", name: "Microsoft", shares: 145000000, value: 54200000000, changePercent: 1.8 },
                    { symbol: "AAPL", name: "Apple Inc", shares: 125000000, value: 23900000000, changePercent: 2.5 },
                    { symbol: "NVDA", name: "NVIDIA", shares: 45000000, value: 20000000000, changePercent: 8.7 },
                    { symbol: "META", name: "Meta Platforms", shares: 38000000, value: 15200000000, changePercent: 5.3 },
                    { symbol: "AMZN", name: "Amazon", shares: 85000000, value: 12900000000, changePercent: 4.2 }
                ]
            },
            // Adding more mock funds to reach 30...
            ...Array.from({length: 24}, (_, i) => ({
                fund: `Fund ${i + 7}`,
                aum: Math.floor(Math.random() * 2000000000000) + 500000000000,
                holdings: [
                    { symbol: "AAPL", name: "Apple Inc", shares: Math.floor(Math.random() * 200000000) + 50000000, value: Math.floor(Math.random() * 50000000000) + 10000000000, changePercent: (Math.random() - 0.5) * 10 },
                    { symbol: "MSFT", name: "Microsoft", shares: Math.floor(Math.random() * 150000000) + 30000000, value: Math.floor(Math.random() * 40000000000) + 8000000000, changePercent: (Math.random() - 0.5) * 8 },
                    { symbol: "GOOGL", name: "Alphabet Inc", shares: Math.floor(Math.random() * 80000000) + 20000000, value: Math.floor(Math.random() * 20000000000) + 5000000000, changePercent: (Math.random() - 0.5) * 12 },
                    { symbol: "AMZN", name: "Amazon", shares: Math.floor(Math.random() * 100000000) + 25000000, value: Math.floor(Math.random() * 30000000000) + 7000000000, changePercent: (Math.random() - 0.5) * 15 },
                    { symbol: "NVDA", name: "NVIDIA", shares: Math.floor(Math.random() * 60000000) + 15000000, value: Math.floor(Math.random() * 25000000000) + 6000000000, changePercent: (Math.random() - 0.5) * 20 }
                ]
            }))
        ];

        // Generate technical analysis data for a stock
        const generateTechnicalData = (symbol) => {
            const days = 60;
            const data = [];
            
            // Base price around realistic levels for major stocks
            const basePrices = {
                'AAPL': 175, 'MSFT': 350, 'GOOGL': 140, 'AMZN': 150, 'NVDA': 450,
                'TSLA': 260, 'META': 400, 'BAC': 35, 'JPM': 175, 'KO': 62, 'CVX': 150
            };
            
            let basePrice = basePrices[symbol] || 100;
            let volume = 50000000;
            let cumulativeVolume = 0;
            let adLine = 0;
            let obvValue = 0;
            
            // RSI calculation variables
            let gains = [];
            let losses = [];
            
            for (let i = 0; i < days; i++) {
                const date = new Date();
                date.setDate(date.getDate() - (days - i));
                
                // Generate realistic price movement
                const volatility = 0.03;
                const trend = Math.sin(i / 10) * 0.001;
                const randomMove = (Math.random() - 0.5) * volatility;
                const priceChange = (trend + randomMove) * basePrice;
                
                const open = basePrice;
                const close = basePrice + priceChange;
                const high = Math.max(open, close) + Math.random() * basePrice * 0.01;
                const low = Math.min(open, close) - Math.random() * basePrice * 0.01;
                
                // Volume with some randomness
                const dailyVolume = volume * (0.7 + Math.random() * 0.6);
                cumulativeVolume += dailyVolume;
                
                // Calculate OBV
                if (i > 0) {
                    if (close > data[i-1].close) {
                        obvValue += dailyVolume;
                    } else if (close < data[i-1].close) {
                        obvValue -= dailyVolume;
                    }
                }
                
                // Calculate A/D Line
                const moneyFlowMultiplier = ((close - low) - (high - close)) / (high - low);
                const moneyFlowVolume = moneyFlowMultiplier * dailyVolume;
                adLine += moneyFlowVolume;
                
                // Calculate RSI
                if (i > 0) {
                    const change = close - data[i-1].close;
                    gains.push(change > 0 ? change : 0);
                    losses.push(change < 0 ? Math.abs(change) : 0);
                    
                    if (gains.length > 14) {
                        gains.shift();
                        losses.shift();
                    }
                }
                
                let rsi = 50;
                if (gains.length >= 14) {
                    const avgGain = gains.reduce((sum, gain) => sum + gain, 0) / 14;
                    const avgLoss = losses.reduce((sum, loss) => sum + loss, 0) / 14;
                    const rs = avgGain / (avgLoss || 0.0001);
                    rsi = 100 - (100 / (1 + rs));
                }
                
                // Simple Stochastic (SCD) - %K and %D
                const lookback = Math.min(i + 1, 14);
                const recentData = data.slice(Math.max(0, i - lookback + 1)).concat([{high, low, close}]);
                const highestHigh = Math.max(...recentData.map(d => d.high));
                const lowestLow = Math.min(...recentData.map(d => d.low));
                const stochK = ((close - lowestLow) / (highestHigh - lowestLow)) * 100;
                
                // %D is 3-period moving average of %K
                const recentK = data.slice(Math.max(0, i - 2)).map(d => d.stochK).filter(k => k !== undefined);
                const stochD = recentK.length > 0 ? 
                    (recentK.reduce((sum, k) => sum + k, 0) + stochK) / (recentK.length + 1) : stochK;
                
                data.push({
                    date: date.toISOString().split('T')[0],
                    open: Math.round(open * 100) / 100,
                    high: Math.round(high * 100) / 100,
                    low: Math.round(low * 100) / 100,
                    close: Math.round(close * 100) / 100,
                    volume: Math.round(dailyVolume),
                    rsi: Math.round(rsi * 100) / 100,
                    stochK: Math.round(stochK * 100) / 100,
                    stochD: Math.round(stochD * 100) / 100,
                    obv: Math.round(obvValue / 1000000), // In millions for readability
                    adLine: Math.round(adLine / 1000000) // In millions for readability
                });
                
                basePrice = close;
            }
            
            return data;
        };

        const processHoldingsData = () => {
            setLoading(true);
            
            setTimeout(() => {
                // Aggregate holdings across all funds
                const stockMap = new Map();
                
                mockFundData.forEach(fund => {
                    fund.holdings.forEach(holding => {
                        if (stockMap.has(holding.symbol)) {
                            const existing = stockMap.get(holding.symbol);
                            existing.totalValue += holding.value;
                            existing.totalShares += holding.shares;
                            existing.fundCount += 1;
                            existing.changePercentSum += holding.changePercent;
                        } else {
                            stockMap.set(holding.symbol, {
                                symbol: holding.symbol,
                                name: holding.name,
                                totalValue: holding.value,
                                totalShares: holding.shares,
                                fundCount: 1,
                                changePercentSum: holding.changePercent
                            });
                        }
                    });
                });

                // Convert to array and calculate averages
                const aggregatedData = Array.from(stockMap.values()).map(stock => ({
                    ...stock,
                    avgChangePercent: stock.changePercentSum / stock.fundCount
                }));

                // Sort by frequency (number of funds holding the stock)
                const topCommonStocks = aggregatedData
                    .sort((a, b) => b.fundCount - a.fundCount)
                    .slice(0, 30);

                // Sort by percentage change
                const topChangeStocks = [...aggregatedData]
                    .sort((a, b) => b.avgChangePercent - a.avgChangePercent)
                    .slice(0, 30);

                // Generate technical data for all stocks
                const techData = {};
                [...topCommonStocks, ...topChangeStocks].forEach(stock => {
                    if (!techData[stock.symbol]) {
                        techData[stock.symbol] = generateTechnicalData(stock.symbol);
                    }
                });

                setCommonStocks(topCommonStocks);
                setChangeAnalysis(topChangeStocks);
                setFundData(mockFundData.slice(0, 30));
                setTechnicalData(techData);
                setLoading(false);
            }, 3000);
        };

        const formatCurrency = (value) => {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                notation: 'compact',
                maximumFractionDigits: 1
            }).format(value);
        };

        const formatNumber = (value) => {
            return new Intl.NumberFormat('en-US', {
                notation: 'compact',
                maximumFractionDigits: 1
            }).format(value);
        };

        return (
            <div className="min-h-screen bg-gray-50 p-3 md:p-6">
                <div className="max-w-7xl mx-auto">
                    {/* Header */}
                    <div className="bg-white rounded-lg shadow-md p-4 md:p-6 mb-4 md:mb-6">
                        <div className="flex flex-col md:flex-row md:items-center md:justify-between">
                            <div className="mb-4 md:mb-0">
                                <h1 className="text-2xl md:text-3xl font-bold text-gray-900 flex items-center">
                                    <Building2 />
                                    <span className="ml-3">13F Fund Holdings Analyzer</span>
                                </h1>
                                <p className="text-gray-600 mt-2 text-sm md:text-base">
                                    Analyze top 30 AUM funds and their most common stock holdings
                                </p>
                            </div>
                            <button
                                onClick={processHoldingsData}
                                disabled={loading}
                                className="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-4 md:px-6 py-2 md:py-3 rounded-lg flex items-center justify-center transition-colors w-full md:w-auto"
                            >
                                <Download />
                                <span className="ml-2">{loading ? 'Processing...' : 'Fetch 13F Data'}</span>
                            </button>
                        </div>
                    </div>

                    {loading && (
                        <div className="bg-white rounded-lg shadow-md p-6 md:p-8 mb-4 md:mb-6">
                            <div className="flex items-center justify-center">
                                <div className="loading-spinner rounded-full h-8 w-8 border-b-2 border-blue-600 mr-4"></div>
                                <span className="text-base md:text-lg">
```
